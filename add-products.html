<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
  <title>Add Product</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background-color: #fafbfc;
      background-image:
        radial-gradient(at 100% 0%, rgba(59, 130, 246, 0.05) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(244, 244, 245, 1) 0px, transparent 50%);
      color: #1e293b;
      min-height: 100vh;

      /* Smooth Page Load */
      opacity: 0;
      animation: pageLoad 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    @keyframes pageLoad {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.02),
        0 10px 15px -3px rgba(0, 0, 0, 0.04),
        0 0 0 1px rgba(0, 0, 0, 0.02);
    }

    .input-base {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .input-base:focus {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.08);
      border-color: #3b82f6;
    }

    .back-btn {
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      transform: translateX(-4px);
    }

    .animate-up {
      animation: slideUpFade 0.5s ease-out forwards;
      opacity: 0;
    }

    @keyframes slideUpFade {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col antialiased">
  <!-- Navigation -->
  <nav
    class="w-full py-4 px-6 md:px-12 flex justify-between items-center bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100/50">
    <a href="main.html"
      class="group flex items-center text-slate-500 hover:text-slate-800 back-btn font-medium text-sm transition-colors">
      <div
        class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center mr-3 group-hover:border-slate-300 shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </div>
      <span>Dashboard</span>
    </a>
  </nav>

  <!-- Main Content -->
  <main class="flex-grow flex items-center justify-center p-4">
    <div class="w-full max-w-xl animate-up">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-slate-800 tracking-tight mb-2">Add New Product</h1>
        <p class="text-slate-500 font-medium">Register mobile devices to your inventory</p>
      </div>

      <div class="glass-card rounded-[2.5rem] p-8 md:p-10 card-shadow border border-white">
        <form id="productForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Brand Dropdown -->
            <div class="space-y-1.5 group">
              <label
                class="text-xs font-bold text-slate-500 ml-1 uppercase tracking-wider group-focus-within:text-blue-600 transition-colors">Manufacturer</label>
              <div class="relative">
                <select id="brand"
                  class="input-base w-full appearance-none rounded-xl border border-slate-200 p-4 text-sm font-medium text-slate-700 outline-none focus:ring-4 focus:ring-blue-500/10 transition-all cursor-pointer"
                  required>
                  <option value="" disabled selected>Select Brand</option>
                  <option>Realme</option>
                  <option>OnePlus</option>
                  <option>Vivo</option>
                  <option>Oppo</option>
                  <option>Samsung</option>
                  <option>Apple</option>
                  <option>Redmi</option>
                  <option>Xiaomi</option>
                  <option>Itel</option>
                  <option>Lava</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-400">
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Model Input -->
            <div class="space-y-1.5 group">
              <label
                class="text-xs font-bold text-slate-500 ml-1 uppercase tracking-wider group-focus-within:text-blue-600 transition-colors">Model
                Name</label>
              <input type="text" id="model" placeholder="e.g. Galaxy S24"
                class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm font-medium text-slate-700 outline-none focus:ring-4 focus:ring-blue-500/10 transition-all"
                required />
            </div>
          </div>

          <div class="w-full h-px bg-slate-100"></div>

          <!-- Dynamic Blocks Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-2">
            <!-- RAM+ROM Dynamic Fields -->
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <label class="text-xs font-bold text-slate-500 ml-1 uppercase tracking-wider">Storage Variants</label>
              </div>
              <div id="ramromContainer" class="space-y-3"></div>
              <button type="button" id="addRamRomBtn"
                class="flex items-center gap-2 text-xs font-bold text-blue-600 hover:text-blue-700 py-2 px-3 rounded-lg hover:bg-blue-50 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                    clip-rule="evenodd" />
                </svg>
                <span>Add Variant</span>
              </button>
            </div>

            <!-- Color Dynamic Fields -->
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <label class="text-xs font-bold text-slate-500 ml-1 uppercase tracking-wider">Available Colors</label>
              </div>
              <div id="colorContainer" class="space-y-3"></div>
              <button type="button" id="addColorBtn"
                class="flex items-center gap-2 text-xs font-bold text-blue-600 hover:text-blue-700 py-2 px-3 rounded-lg hover:bg-blue-50 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                    clip-rule="evenodd" />
                </svg>
                <span>Add Color</span>
              </button>
            </div>
          </div>

          <!-- Submit -->
          <div class="pt-6">
            <button type="submit"
              class="w-full group relative overflow-hidden bg-slate-900 text-white p-5 rounded-[1.25rem] font-bold text-lg shadow-xl shadow-slate-200 transition-all hover:-translate-y-1 active:scale-[0.98] flex items-center justify-center gap-3">
              <span>Save Product Data</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform group-hover:translate-x-1"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </button>
          </div>
        </form>

        <div id="successMsg"
          class="hidden mt-6 bg-emerald-50 border border-emerald-100 text-emerald-700 px-6 py-4 rounded-2xl flex items-center gap-3 font-bold animate-up">
          <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd" />
            </svg>
          </div>
          <span>Product added to inventory successfully!</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="w-full py-8 text-center bg-white/50 backdrop-blur-sm mt-auto">
    <p class="text-xs text-slate-400 font-medium tracking-wide">
      © <span id="current-year"></span> <span class="text-slate-600 font-bold">Dastelecom</span> · STOCK CONTROL
    </p>
  </footer>

  <!-- Firebase Config -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAibWFQ955D9sxgExTvXf9ykC0HJQPbatA",
      authDomain: "dastelecominvoicegenerator.firebaseapp.com",
      databaseURL: "https://dastelecominvoicegenerator-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dastelecominvoicegenerator",
      storageBucket: "dastelecominvoicegenerator.firebasestorage.app",
      messagingSenderId: "959180798639",
      appId: "1:959180798639:web:861d25289ff80c8c17725a",
      measurementId: "G-Y4JJXQGSJC"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Get form elements
    const productForm = document.getElementById("productForm");
    const modelInput = document.getElementById("model");
    const ramromContainer = document.getElementById("ramromContainer");
    const colorContainer = document.getElementById("colorContainer");
    const maxFields = 4;

    // Function to append 5G to any model name
    function checkAndAppend5G() {
      const modelValue = modelInput.value.trim();
      if (!modelValue) return;
      const already5G = / 5G$/i.test(modelValue);
      if (!already5G) {
        modelInput.value = modelValue + " 5G";
      }
    }

    function createInput(name) {
      const wrapper = document.createElement("div");
      wrapper.className = "flex items-center gap-2 group";

      const input = document.createElement("input");
      input.type = "text";
      input.name = name;
      input.placeholder = name === "ramrom" ? "e.g. 6+128GB" : "e.g. Midnight Blue";
      input.className = "input-base w-full p-3 text-sm font-medium text-slate-700 rounded-xl outline-none";
      input.required = true;

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      `;
      removeBtn.className = "p-2 group-hover:bg-red-50 text-slate-300 group-hover:text-red-500 rounded-lg transition-all flex-shrink-0";
      removeBtn.onclick = () => {
        if (wrapper.parentElement.children.length > 1) {
          wrapper.remove();
        }
      };

      wrapper.appendChild(input);
      wrapper.appendChild(removeBtn);
      return { wrapper, input };
    }

    function addField(container, type) {
      if (container.children.length >= maxFields) return;
      const { wrapper, input } = createInput(type);

      if (type === "color") {
        input.addEventListener("focus", checkAndAppend5G);
      }

      container.appendChild(wrapper);
    }

    document.getElementById("addRamRomBtn").onclick = () => addField(ramromContainer, "ramrom");
    document.getElementById("addColorBtn").onclick = () => {
      checkAndAppend5G();
      addField(colorContainer, "color");
    };

    // Add one field by default
    addField(ramromContainer, "ramrom");
    addField(colorContainer, "color");

    // Add focus event to the initial color field
    const initialColorField = colorContainer.querySelector("input");
    if (initialColorField) {
      initialColorField.addEventListener("focus", checkAndAppend5G);
    }

    // Handle form submission
    productForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const data = {
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        ramrom: Array.from(ramromContainer.querySelectorAll("input")).map(i => i.value),
        color: Array.from(colorContainer.querySelectorAll("input")).map(i => i.value),
        timestamp: Date.now()
      };

      // Save to Firebase
      const productsRef = ref(database, 'products');
      const newProductRef = push(productsRef);

      set(newProductRef, data)
        .then(() => {
          document.getElementById("successMsg").classList.remove("hidden");
          setTimeout(() => {
            window.location.href = "main.html";
          }, 1500);
        })
        .catch((error) => {
          alert("Error adding product: " + error.message);
        });
    });

    document.getElementById('current-year').textContent = new Date().getFullYear();
  </script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js")
        .then(() => console.log("Service Worker Registered"));
    }
  </script>
</body>

</html>