<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="manifest" href="/manifest.php">
  <meta name="theme-color" content="#ffffff">
  <title>Add Product</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: #000000;
      min-height: 100vh;
    }

    /* Background grid styling */
    .bg-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: radial-gradient(#ffffff33 1px, #00091d 1px);
      background-size: 20px 20px;
      pointer-events: none;
      z-index: -2;
    }

    /* Content wrapper */
    .content-wrapper {
      position: relative;
      min-height: 100vh;
      width: 100%;
      padding: 2rem 1rem;
    }

    .glass-card {
      background: rgba(0, 9, 29, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.37),
        inset 0 0 32px 0 rgba(255, 255, 255, 0.02),
        0 0 4px 0 rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    .glass-card:hover {
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.37),
        inset 0 0 32px 0 rgba(255, 255, 255, 0.03),
        0 0 8px 0 rgba(255, 255, 255, 0.3);
    }
    .glow-text {
      color: #ffffff;
      text-shadow: 
        0 0 10px rgba(255, 255, 255, 0.5),
        0 0 20px rgba(255, 255, 255, 0.3),
        0 0 30px rgba(255, 255, 255, 0.1);
    }
    .input-glow {
      transition: all 0.3s ease;
    }
    .input-glow:hover {
      border-color: rgba(59, 130, 246, 0.3);
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
    }
    .input-glow:focus {
      border-color: rgba(59, 130, 246, 0.5);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    /* Glowing button effect */
    .glow-btn {
      position: relative;
      z-index: 0;
      overflow: hidden;
    }
    
    .glow-btn::before {
      content: "";
      background: linear-gradient(
        45deg,
        #3b82f6, #60a5fa, #93c5fd, #3b82f6
      );
      position: absolute;
      top: -2px;
      left: -2px;
      background-size: 400%;
      z-index: -1;
      width: calc(100% + 4px);
      height: calc(100% + 4px);
      filter: blur(8px);
      animation: glowing 20s linear infinite;
      transition: opacity .3s ease-in-out;
      border-radius: 10px;
      opacity: 0;
    }
    
    @keyframes glowing {
      0% {background-position: 0 0;}
      50% {background-position: 400% 0;}
      100% {background-position: 0 0;}
    }
    
    .glow-btn:hover::before {
      opacity: 1;
    }
    
    .add-btn {
      transition: all 0.3s ease;
      text-shadow: none;
    }
    
    .add-btn:hover {
      text-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
    }
  </style>
</head>
<body>
  <!-- Fixed background with dotted grid -->
  <div class="bg-grid"></div>

  <!-- Content wrapper -->
  <div class="content-wrapper flex items-center justify-center">
    <div class="w-full max-w-md glass-card rounded-2xl p-6 space-y-6">
      <h2 class="text-2xl font-semibold text-center text-white glow-text">Add Product</h2>

      <form id="productForm" class="space-y-4">
        <!-- Brand Dropdown -->
        <div>
          <label class="block text-sm font-medium text-gray-300">Brand</label>
          <select id="brand" class="w-full mt-1 p-2 bg-gray-800 border border-gray-700 text-white rounded-lg focus:outline-none focus:ring focus:ring-blue-500 focus:border-blue-500 input-glow" required>
            <option value="">Select Brand</option>
            <option>Realme</option>
            <option>OnePlus</option>
            <option>Vivo</option>
            <option>Oppo</option>
            <option>Samsung</option>
          </select>
        </div>

        <!-- Model Input -->
        <div>
          <label class="block text-sm font-medium text-gray-300">Model</label>
          <input type="text" id="model" class="w-full mt-1 p-2 bg-gray-800 border border-gray-700 text-white rounded-lg focus:outline-none focus:ring focus:ring-blue-500 focus:border-blue-500 input-glow" required />
        </div>

        <!-- RAM+ROM Dynamic Fields -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">RAM + ROM</label>
          <div id="ramromContainer" class="space-y-2"></div>
          <button type="button" id="addRamRomBtn" class="text-sm text-blue-400 font-medium hover:text-blue-300 add-btn">+ Add RAM+ROM</button>
        </div>

        <!-- Color Dynamic Fields -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Color</label>
          <div id="colorContainer" class="space-y-2"></div>
          <button type="button" id="addColorBtn" class="text-sm text-blue-400 font-medium hover:text-blue-300 add-btn">+ Add Color</button>
        </div>

        <!-- Submit -->
        <button type="submit" class="w-full text-white bg-gradient-to-br from-purple-600 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center relative overflow-hidden glow-btn">
          <span class="relative z-10">Add Product</span>
          <div class="absolute inset-0 opacity-0 hover:opacity-100 transition-opacity duration-300 bg-gradient-to-br from-purple-600 to-blue-500 blur-xl -m-1 z-0"></div>
        </button>

      </form>

      <div id="successMsg" class="hidden text-green-400 text-center font-medium">
        ✅ Product added successfully!
      </div>
    </div>
  </div>

  <!-- Firebase Config -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAibWFQ955D9sxgExTvXf9ykC0HJQPbatA",
      authDomain: "dastelecominvoicegenerator.firebaseapp.com",
      databaseURL: "https://dastelecominvoicegenerator-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dastelecominvoicegenerator",
      storageBucket: "dastelecominvoicegenerator.firebasestorage.app",
      messagingSenderId: "959180798639",
      appId: "1:959180798639:web:861d25289ff80c8c17725a",
      measurementId: "G-Y4JJXQGSJC"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    // Get form elements
    const productForm = document.getElementById("productForm");
    const modelInput = document.getElementById("model");
    const ramromContainer = document.getElementById("ramromContainer");
    const colorContainer = document.getElementById("colorContainer");
    const maxFields = 4;
    
    // Remove auto-append 5G functionality from model input
    // 5G will only be added when clicking on color fields
    
    // Function to append 5G to any model name
    function checkAndAppend5G() {
      const modelValue = modelInput.value.trim();
      
      // Skip if model field is empty
      if (!modelValue) return;
      
      // Check if 5G is already appended
      const already5G = / 5G$/i.test(modelValue);
      
      if (!already5G) {
        // Auto-append 5G after a space for any model
        modelInput.value = modelValue + " 5G";
        console.log("Appended 5G to model:", modelInput.value);
      }
    }
    
    function createInput(name) {
      const input = document.createElement("input");
      input.type = "text";
      input.name = name;
      input.placeholder = name === "ramrom" ? "e.g. 6+128GB" : "e.g. Midnight Blue";
      input.className = "w-full p-2 bg-gray-800 border border-gray-700 text-white rounded-lg focus:outline-none focus:ring focus:ring-blue-500 focus:border-blue-500 input-glow";
      input.required = true;
      return input;
    }

    function addField(container, type) {
      if (container.children.length >= maxFields) return;
      const input = createInput(type);
      
      // If adding a color field, check if we need to append 5G to the model
      if (type === "color") {
        input.addEventListener("focus", function() {
          checkAndAppend5G();
        });
      }
      
      container.appendChild(input);
    }

    document.getElementById("addRamRomBtn").onclick = () => addField(ramromContainer, "ramrom");
    document.getElementById("addColorBtn").onclick = () => {
      // Check if we need to append 5G to the model when adding a new color field
      checkAndAppend5G();
      addField(colorContainer, "color");
    };

    // Add one field by default
    addField(ramromContainer, "ramrom");
    addField(colorContainer, "color");
    
    // Add focus event to the initial color field
    const initialColorField = colorContainer.querySelector("input");
    if (initialColorField) {
      initialColorField.addEventListener("focus", function() {
        checkAndAppend5G();
      });
    }

    // Handle form submission
    productForm.addEventListener("submit", function(e) {
      e.preventDefault();
      
      const data = {
        brand: document.getElementById("brand").value,
        model: document.getElementById("model").value,
        ramrom: Array.from(ramromContainer.querySelectorAll("input")).map(i => i.value),
        color: Array.from(colorContainer.querySelectorAll("input")).map(i => i.value),
        timestamp: Date.now()
      };
      
      console.log("Product Data to save:", data);
      
      // Save to Firebase
      const productsRef = ref(database, 'products');
      const newProductRef = push(productsRef);
      
      console.log("Saving to Firebase...");
      set(newProductRef, data)
        .then(() => {
          console.log("Product saved successfully with key:", newProductRef.key);
          document.getElementById("successMsg").classList.remove("hidden");
          
          // Show success message for a short time before redirecting
          setTimeout(() => {
            // Redirect to main.html after showing success message
            window.location.href = "main.html";
          }, 1500);
        })
        .catch((error) => {
          console.error("Error adding product:", error);
          alert("Error adding product: " + error.message);
        });
    });
  </script>
  <!-- Footer -->
  <footer class="w-full mt-8 bg-[#000000] bg-[radial-gradient(#ffffff33_1px,#00091d_1px)] bg-[size:20px_20px]">
    <div class="text-center py-4">
      <p class="text-gray-400">
        © <span id="current-year"></span> <span style="color: rgb(217, 119, 87);">Dastelecom</span>. All rights reserved.
      </p>
    </div>
  </footer>

  <script>
    // Set current year automatically
    document.getElementById('current-year').textContent = new Date().getFullYear();
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker
      .register('/service-worker.js')
      .then(() => console.log('Service Worker Registered'))
      .catch((err) => console.log('Service Worker registration failed:', err));
  }
</script>
</body>
</html>
