<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <title>Non-GST Mobile Bill | Dastelecom</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>

  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background-color: #fafbfc;
      background-image:
        radial-gradient(at 100% 0%, rgba(59, 130, 246, 0.05) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(244, 244, 245, 1) 0px, transparent 50%);
      color: #1e293b;

      /* Smooth Page Load */
      opacity: 0;
      animation: pageLoad 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    @keyframes pageLoad {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .card-shadow {
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.02),
        0 10px 15px -3px rgba(0, 0, 0, 0.04),
        0 0 0 1px rgba(0, 0, 0, 0.02);
    }

    .input-base {
      background: #ffffff;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .input-base:focus {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.08);
      border-color: #3b82f6;
    }

    /* Custom Animation */
    @keyframes slideUpFade {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-up {
      animation: slideUpFade 0.5s ease-out forwards;
      opacity: 0;
    }

    .delay-1 {
      animation-delay: 0.1s;
    }

    .delay-2 {
      animation-delay: 0.2s;
    }

    .delay-3 {
      animation-delay: 0.3s;
    }

    .delay-4 {
      animation-delay: 0.4s;
    }

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: #e2e8f0;
      border-radius: 20px;
    }

    /* Focus Ring */
    .focus-ring:focus {
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
      border-color: #3b82f6;
    }

    @keyframes pulse-soft {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }
    }

    .pulse-soft {
      animation: pulse-soft 2s infinite ease-in-out;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col antialiased selection:bg-blue-100 selection:text-blue-600">

  <!-- Navigation -->
  <nav
    class="w-full py-4 px-6 md:px-12 flex justify-between items-center bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100/50">
    <div></div>
    <a href="main.html"
      class="group flex items-center gap-2 px-4 py-2 rounded-full hover:bg-white hover:shadow-sm transition-all text-slate-500 hover:text-blue-600 font-medium text-sm border border-transparent hover:border-slate-100">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform group-hover:-translate-x-1"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      <span>Back to Dashboard</span>
    </a>
  </nav>

  <main class="flex-grow flex items-center justify-center py-6 px-3 sm:py-10 sm:px-6 lg:p-12">
    <div class="max-w-2xl w-full space-y-8">

      <!-- Header -->
      <div class="text-center animate-up">
        <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">Create Non-GST Invoice</h1>
        <p class="text-sm sm:text-base text-slate-500">Professional estimate & challan billing</p>
      </div>

      <!-- Main Card -->
      <div class="glass-effect rounded-2xl sm:rounded-[32px] card-shadow border border-white p-1 animate-up delay-1">
        <div
          class="bg-gradient-to-b from-white to-slate-50/50 rounded-xl sm:rounded-[28px] p-4 sm:p-6 md:p-10 relative overflow-hidden">

          <!-- Decorative Background Elements -->
          <div
            class="absolute top-0 right-0 w-64 h-64 bg-blue-50/30 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none">
          </div>
          <div
            class="absolute bottom-0 left-0 w-64 h-64 bg-indigo-50/30 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none">
          </div>

          <!-- Form Content -->
          <div class="space-y-6 sm:space-y-10 relative z-10">

            <!-- Customer Details -->
            <section>
              <h3 class="text-base sm:text-lg font-bold text-slate-800 mb-4 sm:mb-6 flex items-center gap-2 sm:gap-3">
                <span
                  class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center shadow-inner">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </span>
                Customer Information
              </h3>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <div class="group">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">FULL
                    NAME</label>
                  <input type="text" id="customerName"
                    class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-medium placeholder:text-slate-400"
                    placeholder="Enter full name">
                </div>
                <div class="group">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">PHONE
                    NUMBER</label>
                  <input type="tel" id="mobile"
                    class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-medium placeholder:text-slate-400"
                    placeholder="10-digit mobile number">
                </div>
                <div class="md:col-span-2 group">
                  <label
                    class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">ADDRESS</label>
                  <textarea id="address" rows="2"
                    class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-medium placeholder:text-slate-400 resize-none"
                    placeholder="Complete residential or office address"></textarea>
                </div>
              </div>
            </section>

            <div class="w-full h-px bg-slate-100"></div>

            <!-- Device Details -->
            <section>
              <h3 class="text-base sm:text-lg font-bold text-slate-800 mb-4 sm:mb-6 flex items-center gap-2 sm:gap-3">
                <span
                  class="w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center shadow-inner">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                  </svg>
                </span>
                Device Details
              </h3>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <!-- Brand Selector -->
                <div class="md:col-span-2">
                  <label
                    class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">MANUFACTURER</label>
                  <div class="relative">
                    <div id="brandBtn"
                      class="w-full bg-white border border-slate-200 hover:border-blue-400 rounded-xl px-3 sm:px-4 py-3 sm:py-4 relative flex items-center justify-between cursor-pointer transition-all active:scale-[0.99] min-h-[56px] sm:min-h-[60px] shadow-sm">
                      <div class="flex items-center gap-3">
                        <img id="brandIcon" src="" class="h-8 hidden object-contain">
                        <span id="brandPlaceholder" class="text-slate-400 font-medium">Select Brand</span>
                      </div>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>

                    <!-- Dropdown -->
                    <div id="brandList"
                      class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-2xl border border-slate-100 shadow-xl z-50 p-2 animate-up overflow-hidden">
                      <div class="grid grid-cols-2 gap-2">
                        <div onclick="selectBrand('Itel')"
                          class="cursor-pointer p-3 sm:p-4 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-100 flex items-center justify-center transition-all h-16 sm:h-20 group">
                          <img src="https://upload.wikimedia.org/wikipedia/commons/d/d9/Itel-mobile-logo-vector.svg"
                            alt="Itel"
                            class="h-8 w-auto object-contain opacity-60 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div onclick="selectBrand('Lava')"
                          class="cursor-pointer p-3 sm:p-4 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-100 flex items-center justify-center transition-all h-16 sm:h-20 group">
                          <img src="https://upload.wikimedia.org/wikipedia/commons/6/63/Lava_International.svg"
                            alt="Lava"
                            class="h-6 w-auto object-contain opacity-60 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div onclick="selectBrand('Nokia')"
                          class="cursor-pointer p-3 sm:p-4 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-100 flex items-center justify-center transition-all h-16 sm:h-20 group">
                          <img src="nokia.svg" alt="Nokia"
                            class="h-8 w-auto object-contain opacity-60 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div onclick="selectBrand('HMD')"
                          class="cursor-pointer p-3 sm:p-4 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-100 flex items-center justify-center transition-all h-16 sm:h-20 group">
                          <img src="HMD.png" alt="HMD"
                            class="h-8 w-auto object-contain opacity-60 group-hover:opacity-100 transition-opacity">
                        </div>
                      </div>
                    </div>
                    <input type="hidden" id="brand">
                  </div>
                </div>

                <div class="group">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">MODEL</label>
                  <input type="text" id="model"
                    class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-medium placeholder:text-slate-400"
                    placeholder="e.g. Y21">
                </div>
                <div class="group">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">COLOR</label>
                  <input type="text" id="colour"
                    class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-medium placeholder:text-slate-400"
                    placeholder="e.g. Midnight Blue">
                </div>

                <div class="group md:col-span-2">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">IMEI
                    1</label>
                  <div class="flex gap-2">
                    <div class="relative flex-grow">
                      <input id="imei" type="text" maxlength="15"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 15)"
                        class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-mono font-medium placeholder:text-slate-400 shadow-sm"
                        placeholder="Scan or enter 15-digit number">
                    </div>
                    <button onclick="startScan('imei')" type="button"
                      class="bg-white border border-slate-200 hover:border-blue-500 text-blue-600 p-3 sm:p-4 rounded-xl transition-all active:scale-95 shadow-sm flex items-center justify-center min-w-[48px] group">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-110 transition-transform"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                      </svg>
                    </button>
                  </div>
                </div>

                <div class="group md:col-span-2">
                  <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">IMEI 2
                    (Optional)</label>
                  <div class="flex gap-2">
                    <div class="relative flex-grow">
                      <input id="imei2" type="text" maxlength="15"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 15)"
                        class="input-base w-full rounded-xl border border-slate-200 p-4 text-sm focus-ring outline-none text-slate-700 font-mono font-medium placeholder:text-slate-400 shadow-sm"
                        placeholder="Scan or enter 15-digit number">
                    </div>
                    <button onclick="startScan('imei2')" type="button"
                      class="bg-white border border-slate-200 hover:border-blue-500 text-blue-600 p-3 sm:p-4 rounded-xl transition-all active:scale-95 shadow-sm flex items-center justify-center min-w-[48px] group">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-110 transition-transform"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Pricing -->
            <section class="animate-up delay-2">
              <div
                class="bg-blue-50/40 rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 border border-blue-100/50 shadow-inner">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4 mb-4 sm:mb-6">
                  <div>
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest">Unit Price</h3>
                    <p class="text-xs text-slate-400 mt-1">Base price per device</p>
                  </div>
                  <div class="relative group w-full sm:w-48">
                    <span
                      class="absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold group-focus-within:text-blue-500 transition-colors">₹</span>
                    <input type="number" id="price"
                      class="w-full bg-white border border-blue-100 rounded-xl sm:rounded-2xl pl-8 sm:pl-10 pr-3 sm:pr-4 py-3 sm:py-4 text-right font-bold text-slate-800 outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-400 transition-all shadow-sm text-base sm:text-lg"
                      placeholder="0.00" oninput="total.value = price.value || 0">
                  </div>
                </div>

                <div class="w-full h-px bg-blue-100/50 mb-4 sm:mb-6"></div>

                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
                  <div class="flex items-center gap-2 sm:gap-3">
                    <div
                      class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-white flex items-center justify-center text-blue-600 shadow-sm border border-blue-50">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                    </div>
                    <div>
                      <span class="text-slate-800 font-bold block text-base sm:text-xl">Total Amount</span>
                      <span class="text-[10px] sm:text-xs text-blue-500 font-bold flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                            clip-rule="evenodd" />
                        </svg>
                        Inclusive of all taxes
                      </span>
                    </div>
                  </div>
                  <div
                    class="text-3xl sm:text-4xl font-black text-blue-600 tracking-tight flex items-center w-full sm:w-auto justify-end">
                    <span class="text-lg sm:text-xl text-slate-400 mr-1 font-medium italic">₹</span>
                    <input type="number" id="total"
                      class="bg-transparent text-right w-32 sm:w-44 outline-none pointer-events-none" value="0"
                      readonly>
                  </div>
                </div>
              </div>
            </section>

            <!-- Submit -->
            <div class="animate-up delay-3 pt-2 sm:pt-4">
              <button onclick="submitBill()" type="button"
                class="w-full group relative overflow-hidden bg-blue-600 text-white p-3 sm:p-4 rounded-2xl sm:rounded-[24px] font-bold text-base sm:text-lg shadow-xl shadow-blue-600/20 transition-all hover:-translate-y-1 hover:shadow-2xl active:scale-[0.98]">
                <div
                  class="absolute inset-0 bg-gradient-to-r from-blue-400/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000">
                </div>
                <div class="relative flex items-center justify-center gap-2 sm:gap-3">
                  <span>Submit</span>
                </div>
              </button>
            </div>

          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center pb-8 animate-up delay-4">
        <div class="flex items-center justify-center gap-4 mb-4">
          <div class="h-px w-8 bg-slate-200"></div>
          <span class="text-xs font-black text-slate-300 uppercase tracking-[0.2em] font-mono">End of Form</span>
          <div class="h-px w-8 bg-slate-200"></div>
        </div>
        <p class="text-xs text-slate-400 font-medium tracking-wide">
          &copy; 2026 <span class="text-slate-600 font-black">DASTELECOM</span>. All Rights Reserved.
        </p>
      </footer>
    </div>
  </main>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAibWFQ955D9sxgExTvXf9ykC0HJQPbatA",
      authDomain: "dastelecominvoicegenerator.firebaseapp.com",
      databaseURL: "https://dastelecominvoicegenerator-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dastelecominvoicegenerator",
      storageBucket: "dastelecominvoicegenerator.firebasestorage.app",
      messagingSenderId: "959180798639",
      appId: "1:959180798639:web:861d25289ff80c8c17725a",
      measurementId: "G-Y4JJXQGSJC"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Brand Dropdown
    const brandBtn = document.getElementById("brandBtn");
    const brandList = document.getElementById("brandList");
    const brandIcon = document.getElementById("brandIcon");
    const brandInput = document.getElementById("brand");
    const brandPlaceholder = document.getElementById("brandPlaceholder");

    brandBtn.onclick = () => {
      brandList.classList.toggle('hidden');
    };

    // Close dropdown when clicking outside
    window.onclick = (e) => {
      if (!brandBtn.contains(e.target)) {
        brandList.classList.add('hidden');
      }
    };

    function selectBrand(name) {
      brandInput.value = name;
      brandIcon.classList.remove("hidden");
      brandPlaceholder.classList.add("hidden");

      if (name === "Itel") {
        brandIcon.src = "https://upload.wikimedia.org/wikipedia/commons/d/d9/Itel-mobile-logo-vector.svg";
        brandIcon.style.height = "32px";
      } else if (name === "Lava") {
        brandIcon.src = "https://upload.wikimedia.org/wikipedia/commons/6/63/Lava_International.svg";
        brandIcon.style.height = "24px";
      } else if (name === "Nokia") {
        brandIcon.src = "nokia.svg";
        brandIcon.style.height = "32px";
      } else if (name === "HMD") {
        brandIcon.src = "HMD.png";
        brandIcon.style.height = "32px";
      }

      brandList.classList.add('hidden');
      brandBtn.classList.add('border-blue-500', 'bg-blue-50/20');
      brandBtn.classList.remove('border-dashed');
    }

    // IMEI Scanner
    // IMEI Scanner using html5-qrcode
    let html5QrCode;

    async function startScan(targetId = 'imei') {
      try {
        // Create scanner overlay
        const overlay = document.createElement('div');
        overlay.id = 'scanner-overlay';
        overlay.className = 'fixed inset-0 bg-white/95 z-[100] flex flex-col items-center justify-center p-6 backdrop-blur-xl';
        overlay.innerHTML = `
          <div class="relative w-full max-w-sm aspect-[4/3] border-[4px] border-slate-100 rounded-[32px] overflow-hidden shadow-2xl bg-white">
            <div id="reader" class="w-full h-full overflow-hidden rounded-[28px]"></div>
            <div class="absolute inset-0 border-[40px] border-white/60 pointer-events-none z-10"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-32 border-2 border-blue-500/40 rounded-2xl pointer-events-none z-20"></div>
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-600 to-transparent shadow-[0_0_15px_rgba(37,99,235,0.4)] animate-[scan_2.5s_infinite] pointer-events-none z-20"></div>
          </div>
          <style> 
            @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } } 
            #reader video { object-fit: cover; width: 100% !important; height: 100% !important; border-radius: 44px; }
          </style>
          
          <div class="mt-12 text-center space-y-4 animate-up">
            <h2 class="text-2xl font-bold text-slate-900 tracking-tight">Scanning IMEI</h2>
            <p class="text-slate-500 font-medium max-w-xs mx-auto text-sm leading-relaxed">Position the 15-digit IMEI barcode clearly within the frame</p>
          </div>
          
          <button id="closeScanner" class="mt-12 bg-slate-900 hover:bg-black text-white px-10 py-4 rounded-2xl font-bold transition-all hover:scale-105 active:scale-95 shadow-lg shadow-slate-200">Cancel Session</button>
        `;
        document.body.appendChild(overlay);

        html5QrCode = new Html5Qrcode("reader");
        const onScanSuccess = (decodedText, decodedResult) => {
          document.getElementById(targetId).value = decodedText;
          stopScanner();
        };

        // Configuration without restrictive constraints
        const config = {
          fps: 15,
          qrbox: {
            width: 250,
            height: 250
          }
        };

        try {
          // First, try to get available cameras
          const devices = await Html5Qrcode.getCameras();

          if (devices && devices.length > 0) {
            // Try to find a back/rear camera
            const backCamera = devices.find(device =>
              device.label.toLowerCase().includes('back') ||
              device.label.toLowerCase().includes('rear') ||
              device.label.toLowerCase().includes('environment')
            );

            // Use back camera if found, otherwise the first available one
            const cameraId = backCamera ? backCamera.id : devices[0].id;
            console.log("Starting camera:", backCamera ? "Back" : "Default", cameraId);

            await html5QrCode.start(cameraId, config, onScanSuccess);
          } else {
            // Fallback to generic constraints if enumeration fails but no error thrown
            await html5QrCode.start({
              facingMode: "environment"
            }, config, onScanSuccess);
          }
        } catch (err) {
          console.warn("Primary camera start failed, trying last resort mode:", err);
          try {
            // Last resort: any camera with minimal constraints
            await html5QrCode.start({
              facingMode: "user"
            }, config, onScanSuccess);
          } catch (finalErr) {
            throw new Error("Could not find or access any camera. Please ensure camera permissions are granted.");
          }
        }

        document.getElementById('closeScanner').onclick = stopScanner;

      } catch (err) {
        console.error(err);
        alert("Camera access failed: " + err);
        if (document.getElementById('scanner-overlay')) {
          document.getElementById('scanner-overlay').remove();
        }
      }
    }

    function stopScanner() {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          html5QrCode.clear();
          const overlay = document.getElementById('scanner-overlay');
          if (overlay) overlay.remove();
        }).catch(err => {
          console.error("Failed to stop scanner", err);
          const overlay = document.getElementById('scanner-overlay');
          if (overlay) overlay.remove();
        });
      } else {
        const overlay = document.getElementById('scanner-overlay');
        if (overlay) overlay.remove();
      }
    }

    async function startScanner() {
      try {
        let stream;
        try {
          // Try environment (back) camera first
          stream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment"
            },
            audio: false
          });
        } catch (e) {
          console.warn("Environment camera not found, trying any video device", e);
          // Fallback to any available camera
          stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: false
          });
        }

        const video = document.getElementById("video");
        if (video) {
          video.srcObject = stream;
          video.play();
        } else {
          console.error("Video element not found");
        }

      } catch (err) {
        console.error("Camera error:", err);
        alert("Camera permission denied or no camera found on this device.");
      }
    }

    function submitBill() {
      const submitBtn = document.querySelector('button[onclick="submitBill()"]');
      const originalContent = submitBtn.innerHTML;

      const data = {
        fullName: document.getElementById("customerName").value.trim(),
        phoneNumber: document.getElementById("mobile").value.trim(),
        address: document.getElementById("address").value.trim(),
        manufacturer: document.getElementById("brand").value.trim(),
        model: document.getElementById("model").value.trim(),
        color: document.getElementById("colour").value.trim(),
        imei1: document.getElementById("imei").value.trim(),
        imei2: document.getElementById("imei2").value.trim(),
        totalAmount: parseFloat(document.getElementById("total").value) || 0,
        timestamp: new Date().toISOString()
      };

      if (!data.fullName || !data.phoneNumber || !data.manufacturer || !data.model || !data.imei1 || data.totalAmount <= 0) {
        alert("Please fill all required fields and ensure price is valid");
        return;
      }

      if (data.imei1.length !== 15) {
        alert("IMEI 1 must be exactly 15 digits");
        return;
      }

      // Show loading state
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <div class="flex items-center justify-center gap-3">
          <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Saving Entry...</span>
        </div>
      `;

      // Save directly to nonGST/lastEntry (overwrites previous data)
      database.ref("nonGST/lastEntry").set(data)
        .then(() => {
          submitBtn.innerHTML = `
          <div class="flex items-center justify-center gap-3">
            <div class="w-6 h-6 bg-white rounded-full flex items-center justify-center">
              <svg class="h-4 w-4 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <span>Submitted Successfully</span>
          </div>
        `;
          setTimeout(() => {
            window.location.href = "main.html";
          }, 1200);
        })
        .catch((error) => {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalContent;
          alert("Error saving to Firebase: " + error.message);
        });
    }
  </script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js")
        .then(() => console.log("Service Worker Registered"));
    }
  </script>
</body>

</html>